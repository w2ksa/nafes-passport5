/*
 * Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨ Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³
 */

import { initializeApp } from "firebase/app";
import { getFirestore, collection, addDoc } from "firebase/firestore";
import { readFileSync } from "fs";
import { fileURLToPath } from "url";
import { dirname, resolve } from "path";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Ù‚Ø±Ø§Ø¡Ø© Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
function loadEnv() {
  try {
    const envPath = resolve(__dirname, "..", ".env");
    const envContent = readFileSync(envPath, "utf-8");
    const env = {};
    
    envContent.split("\n").forEach((line) => {
      const trimmed = line.trim();
      if (trimmed && !trimmed.startsWith("#")) {
        const [key, ...valueParts] = trimmed.split("=");
        if (key && valueParts.length > 0) {
          env[key.trim()] = valueParts.join("=").trim();
        }
      }
    });
    
    return env;
  } catch (error) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù .env:", error.message);
    process.exit(1);
  }
}

const env = loadEnv();

const firebaseConfig = {
  apiKey: env.VITE_FIREBASE_API_KEY,
  authDomain: env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: env.VITE_FIREBASE_APP_ID,
};

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ - Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³
const students = [
  // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (22 Ø·Ø§Ù„Ø¨)
  "Ø§Ø³Ø± Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù„ÙŠ Ø¢Ù„ Ù†Ø§Ø²Ø­",
  "Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ",
  "Ø§Ø­Ù…Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ø­Ù…Ø¯ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„ Ù…Ø­Ù…Ø¯ Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„ Ø­Ù…Ø¯Ø§Ù†",
  "Ø§Ù„Ù…Ø«Ù†Ù‰ Ù…Ø­Ù…Ø¯ Ø´Ø¹Ø´ÙˆØ¹ Ø§Ù„Ø§Ø³Ù…Ø±ÙŠ",
  "Ø¨ØªØ§Ù„ Ø³Ø¹ÙŠØ¯ Ø¹ÙˆØ¸Ù‡ Ø¢Ù„ ÙˆØ§ÙƒØ¯",
  "ØªØ±ÙƒÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "ØªÙ…ÙŠÙ… Ø­Ø°ÙŠÙÙ‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ù„ÙŠÙ…ÙŠ",
  "ØªÙ…ÙŠÙ… Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¸Ø§ÙØ± Ø§Ù„ Ù‡ÙŠØ§Ù„",
  "Ø³Ù„Ø·Ø§Ù† Ù…ÙˆØ³Ù‰ Ø¨Ù† ÙŠØ­ÙŠ Ø¨Ù† Ø­ÙŠØ§Ù†",
  "ØµÙ‚Ø± Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ",
  "Ø·Ù„Ø§Ù„ ÙÙ‡Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø¬ÙŠØ¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ù…Ø±ÙŠ",
  "Ø¹Ù…Ø± Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„ Ø²Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "ÙÙŠØµÙ„ Ø§Ø¨Ù† Ù…Ø§Ø¬Ø¯ Ø¨Ù† Ø¹Ù„ÙŠ Ø¨Ù† Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø³ÙŠØ±ÙŠ",
  "Ù…Ø­Ù…Ø¯ Ø³Ø¹ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ù…Ø´Ø¹Ù„ Ø®Ø§Ù„Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ù…Ù‡Ù†Ø¯ Ø²ÙŠØ§Ø¯ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ",
  "Ù†Ø§Ø¯Ø± Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ø¹Ù„ÙŠ Ø§Ù„Ù‚Ø±Ù†ÙŠ",
  "Ù†ÙˆØ§Ù Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ø¨Ù† Ù…ØªØ¹Ø¨ Ø¢Ù„ Ù‡Ø§Ø¯ÙŠ",
  "ÙŠØ§ Ù…Ù† Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø§Ù„Ù…Ø¹ÙŠ",
  
  // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (23 Ø·Ø§Ù„Ø¨)
  "Ø§Ù†Ø³ Ù…Ø­Ù…Ø¯ ÙŠØ­ÙŠ Ø§Ù„ Ø¹Ù…Ø§Ø±",
  "Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ø­Ù…Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø§Ø¨Ø±Ø§Ù‡ÛŒÙ… Ø²Ù‡ÙŠØ± Ù…Ø­Ù…Ø¯ Ø§Ù„ Ø¹Ø§Øµ",
  "Ø¬Ø¨Ø±Ø§Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø³ÙØ± Ø§Ù„Ø²Ù‡ÙŠØ±ÙŠ",
  "Ø®Ø§Ù„Ø¯ Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
  "Ø®Ø§Ù„Ø¯ ÙÙŠØµÙ„ Ø¹Ù„ÙŠ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø®Ø§Ù„Ø¯ ÙŠØ­ÙŠ Ù…Ø­Ù…Ø¯ Ø§Ù„ Ø´ÙˆÙŠÙ„",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø¸Ø§ÙØ± Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø¢Ù„ Ù…Ø¶Ø­ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† ÙÙ‡Ø¯ Ø¹Ø«Ù…Ø§Ù† Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ø²ÙƒØ±ÙŠØ§ Ù…Ø­Ù…Ø¯ Ø¹Ø±ÙŠØ¨ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø¹Ù„ÙŠ Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠ Ø§Ù„Ù‚Ø§Ø³Ù…ÙŠ Ø¹Ø³ÙŠØ±ÙŠ",
  "ÙØ§Ø±Ø³ Ø­Ø³ÙŠÙ† Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "ÙÙ‡Ø¯ Ø¹Ù„Ù‰ ÙŠØ­ÙŠ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "ÙÙˆØ§Ø² Ø¸Ø§ÙØ± Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø¢Ù„ Ù…Ø¶Ø­ÙŠ",
  "ÙÙŠØµÙ„ Ù…Ø±Ø¨Ø¹ Ø³Ø¹Ø¯ Ù‡Ø¨Ø§Ø´",
  "Ù…Ø­Ù…Ø¯ Ø£ÙŠÙ…Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¢Ù„ Ù…Ø·Ø§Ø¹Ù†",
  "Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ù…Ø­Ù…Ø¯ Ø·Ø§Ù‡Ø± Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
  "Ù…Ø´Ø§Ø±ÙŠ Ø³Ø¹ÙŠØ¯ Ù…Ø§Ù†Ø¹ Ø§Ù„Ø§Ø­Ù…Ø±ÙŠ",
  "Ù†Ø§Ø¯Ø± Ø³Ø§Ù„Ù… Ù…Ù‡Ø¯ÙŠ Ø¢Ù„ Ù…Ø¹Ù…Ø±",
  "ÙŠØ²Ù† Ø¨Ø´ÙŠØ± Ø¨Ù† ÙŠØ­ÙŠ Ø§Ù„ÙÙ‚ÙŠÙ‡",
  
  // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (19 Ø·Ø§Ù„Ø¨)
  "Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„ÙƒØ±ÙŠÙ… Ø§Ø­Ù…Ø¯ Ø¹Ù„Ù‰",
  "Ø§Ù„Ø¨Ø±Ø§Ø¡ Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø¨ØªØ§Ù„ Ø³Ø¹ÙˆØ¯ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø§Ø³Ù…Ø±ÙŠ",
  "Ø¬Ø³Ø§Ø± Ø·Ø§Ø±Ù‚ Ø­Ø³Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø®Ø§Ù„Ø¯ Ø¨Ù† ÙˆÙ„ÙŠØ¯ ÙŠØ­ÙŠÙ‰ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø®Ø§Ù„Ø¯ Ø³Ø¹Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø¹Ù…Ø±ÙŠ",
  "Ø¯ÙˆÙŠÙ„ Ù…Ø­Ù…Ø¯ Ø¯ÙˆÙŠÙ„ Ø¨Ø§Ù„Ø­Ø§Ù…Ø¶",
  "Ø³Ø¹ÙŠØ¯ Ø³ÙØ± Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "Ø¸Ø§ÙØ± Ù…Ø­Ù…Ø¯ Ø¸Ø§ÙØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ø³Ø¹ÙŠØ¯ ÙŠØ­ÙŠ Ø§Ù„ Ø´ÙˆÙŠÙ„",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ù…Ø±ÙŠ",
  "Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø¢Ù„ Ø¹Ù„ÙŠÙ‡",
  "Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯ Ù…Ù†ØµÙˆØ± Ù…Ø¯Ø®Ù„ÙŠ",
  "ÙØ§Ø±Ø³ ÙØ§ÙŠØ² Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
  "ÙØ§Ø±Ø³ Ù…Ø­Ù…Ø¯ Ø¸Ø§ÙØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ",
  "ÙÙŠØµÙ„ ØµØ§Ù„Ø­ Ø®Ù„ÙˆÙÙ‡ Ø§Ù„Ø§Ø­Ù…Ø±ÙŠ",
  "Ù…Ø²ÙŠØ¯ Ø³Ø¹ÙŠØ¯ Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ",
  "Ù…Ø´Ø¹Ù„ Ù…Ø­Ù…Ø¯ Ù…Ù‡Ø¯ÙŠ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "ÙˆØ³Ø§Ù… ÙŠØ¹Ù† Ø§Ù„Ù„Ù‡ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
];

async function addStudents() {
  try {
    console.log("ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Firebase...");
    
    if (!firebaseConfig.apiKey || !firebaseConfig.projectId) {
      console.error("âŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Firebase ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© ÙÙŠ Ù…Ù„Ù .env");
      process.exit(1);
    }
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    console.log(`ğŸ“‹ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© ${students.length} Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³...\n`);

    let addedCount = 0;
    let errorCount = 0;

    for (const studentName of students) {
      try {
        const studentData = {
          name: studentName.trim(),
          grade: 6,
          points: {
            arabic: 0,
            math: 0,
            science: 0,
            morningAssembly: 0,
            nafesExams: 0,
          },
          totalPoints: 0,
          rank: {
            id: 1,
            nameAr: "Ù…Ø³ØªÙƒØ´Ù ØµØºÙŠØ±",
            nameEn: "Junior Explorer",
            minPoints: 0,
            maxPoints: 10,
            icon: "ğŸŒ",
          },
          stamps: {
            silver: false,
            gold: false,
            diamond: false,
          },
          viewCount: 0,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString(),
        };

        await addDoc(collection(db, "students"), studentData);
        addedCount++;
        console.log(`âœ… [${addedCount}/${students.length}] ${studentName}`);
      } catch (error) {
        errorCount++;
        console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© ${studentName}:`, error.message);
      }
    }

    console.log(`\nâœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ${addedCount} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!`);
    if (errorCount > 0) {
      console.log(`âš ï¸  ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© ${errorCount} Ø·Ø§Ù„Ø¨`);
    }
    
    process.exit(0);
  } catch (error) {
    console.error("\nâŒ Ø®Ø·Ø£:", error.message);
    if (error.code === "permission-denied") {
      console.error("âš ï¸  Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª - ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Firestore");
    }
    process.exit(1);
  }
}

addStudents();

