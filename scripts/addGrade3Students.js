/*
 * Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨ Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«
 */

import { initializeApp } from "firebase/app";
import { getFirestore, collection, addDoc } from "firebase/firestore";
import { readFileSync } from "fs";
import { fileURLToPath } from "url";
import { dirname, resolve } from "path";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Ù‚Ø±Ø§Ø¡Ø© Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
function loadEnv() {
  try {
    const envPath = resolve(__dirname, "..", ".env");
    const envContent = readFileSync(envPath, "utf-8");
    const env = {};
    
    envContent.split("\n").forEach((line) => {
      const trimmed = line.trim();
      if (trimmed && !trimmed.startsWith("#")) {
        const [key, ...valueParts] = trimmed.split("=");
        if (key && valueParts.length > 0) {
          env[key.trim()] = valueParts.join("=").trim();
        }
      }
    });
    
    return env;
  } catch (error) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù .env:", error.message);
    process.exit(1);
  }
}

const env = loadEnv();

const firebaseConfig = {
  apiKey: env.VITE_FIREBASE_API_KEY,
  authDomain: env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: env.VITE_FIREBASE_APP_ID,
};

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ - Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«
const students = [
  // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (24 Ø·Ø§Ù„Ø¨)
  "Ø§Ø³Ø§Ù…Ù‡ Ù…Ù‡Ù†Ø¯ Ø³Ø¹ÙŠØ¯ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø¨ØªØ§Ù„ Ø¹Ù„Ù‰ Ø³Ø§Ø¨Ø± Ø§Ù„Ø§Ø³Ù…Ø±ÙŠ",
  "Ø­Ø³ÙŠÙ† Ø¹Ù„Ù‰ Ø­Ø³ÙŠÙ† Ø¢Ù„ Ø¹Ø¯ÙŠÙ†Ø§Ù†",
  "Ø®Ø§Ù„Ø¯ Ø³Ø¹Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø±Ø§Ø¦Ø¯ Ø§Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø±Ø§ÙƒØ§Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
  "Ø²Ø§ÙŠØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "Ø²ÙŠØ§Ø¯ Ù…Ø­Ù…Ø¯ Ø­Ø³ÙŠÙ† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø³Ø¹ÙˆØ¯ ØªØ±ÙƒÙŠ Ø¹Ù„ÙŠ Ø§Ù„Ø§Ø³Ù…Ø±ÙŠ",
  "Ø³Ø¹ÙŠØ¯ Ø¹Ù„ÙŠ Ø§Ø¨Ù† ÙŠØ­ÙŠ Ø¨Ù† Ø´Ø¨Ø¹Ø§Ù†",
  "Ø³Ø¹ÙŠØ¯ Ù…Ø­Ù…Ø¯ Ø­Ø³Ù† Ù‚Ø­Ø·Ø§Ù†ÛŒ",
  "Ø³Ù„Ù…Ø§Ù† Ù…Ø±Ø¨Ø¹ Ø³Ø¹Ø¯ Ù‡Ø¨Ø§Ø´",
  "Ù…Ù†Ø¯ Ù†Ø§ØµØ± Ù…Ø­Ù…Ø¯ Ø¹Ù„Ø§ÙŠ",
  "Ø³ÙŠÙ Ù†Ø§ØµØ± Ù…Ø­Ù…Ø¯ Ø¹Ù„Ø§ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ù„ÙŠ Ø¨Ù† Ø¹ÙˆØ¶ Ø§Ù„ÙˆØ§Ø¯Ø¹ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¢Ù„ Ù†Ø§Ø¬ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ù„Ùƒ ÙØ§Ø±Ø³ Ø§Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø±Ø­Ø§Ù†",
  "Ø¹Ø²Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ù…Ø­Ù…Ø¯ Ø§Ù†Ø³ Ù…Ø­Ù…Ø¯ Ù…Ø¬Ø¯ÙˆØ¹",
  "Ù…Ø­Ù…Ø¯ Ø¹Ø§Ø¯Ù„ Ù…Ø­Ù…Ø¯ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ù…Ø­Ù…Ø¯ Ø§Ø¨Ùˆ Ø³Ø¨Ø¹Ù‡",
  "Ù…Ø´Ù‡ÙˆØ± Ù…Ø³ÙØ± Ø³Ø¹ÙŠØ¯ Ø¢Ù„ ÙƒØ¹Ø¨Ø§Ù†",
  "Ù†Ø§ÙŠÙ ØºØ§Ø²ÙŠ Ø¹ÙˆØ¶ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "ÙˆØ³Ø§Ù… Ø­Ø§ÙØ¸ Ø§Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ",
  
  // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (22 Ø·Ø§Ù„Ø¨)
  "Ø£ÙˆØ³ ÙŠØ­ÙŠ Ø¹Ø§ÙŠØ¶ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø§ÙŠØ§Ø³ ÙØ§Ø¦Ø¹ Ø¹Ù„ÙŠ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø¨Ø§Ø³Ù„ Ø¬Ø¨Ø±Ø§Ù† Ø­Ø³Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø­Ù…Ø²Ù‡ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø­Ø³Ù† Ø§Ù„ÙˆØ§Ø¯Ø¹ÙŠ",
  "Ø®Ø§Ù„Ø¯ Ø³Ù„Ø·Ø§Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ",
  "Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø£Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ù„ÙŠ",
  "Ø®Ø§Ù„Ø¯ Ø¹Ù„Ù‰ Ù…Ø­Ù…Ø¯ Ø¹ÙŠØ§Ø´ÙŠ",
  "Ø³Ø¹Ø¯ Ù…ØµØ·ÙÙ‰ Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø³Ù„Ù…Ø§Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø­Ø³ÙŠÙ† Ø¨Ø§Ù„Ø­Ø§Ø±Ø«",
  "Ø³Ù†Ø¯ Ø®Ø§Ù„Ø¯ Ø§Ø­Ù…Ø¯ Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠ",
  "ØµÙ‚Ø± Ø¹ÙˆØ¶ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø¹Ø§Ø¯Ù„ Ø¹Ù„ÙŠ Ø³Ø¹Ø¯ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ù…Ø­Ù…Ø¯ Ø¬Ø±Ø¨ÙˆØ¹ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "ÙÙ‡Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ",
  "ÙÙŠØµÙ„ Ø³Ø¹ÙˆØ¯ Ù„Ø§Ø­Ù‚ Ù…Ø³ÙˆØ¯",
  "Ú©Ø±Ù… Ø®Ø§Ù„Ø¯ Ø±Ø§ØªØ¨ Ø§Ù„Ø²Ø±ÙŠØ±",
  "Ù…Ø­Ù…Ø¯ Ø±Ø§Ø´Ø¯ Ø¹Ù„ÙŠ Ø¢Ù„ Ù‡ØªÙŠÙ„Ù‡",
  "Ù…Ø­Ù…Ø¯ Ø¹Ø§Ù…Ø± Ø±Ø§Ø¶ÙŠ Ø§Ù„Ø¯ØºØ§Ù…ÙŠÙ†",
  "Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ø­Ù…Ø¯ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ù…Ù‡Ù†Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ù‡ Ø§Ù„Ø³ÙŠØ¯",
  "Ù‡Ø§Ø¯ÙŠ Ø­Ø³ÙŠÙ† Ù‡Ø§Ø¯ÙŠ Ø§Ù„ÙˆØ§Ø¯Ø¹ÙŠ",
  "ÙŠØ²ÙŠØ¯ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ",
  
  // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (25 Ø·Ø§Ù„Ø¨)
  "Ø¨Ø§Ø³Ù„ Ù…Ø­Ù…Ø¯ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø¨Ø¯Ø± Ù…Ø§Ø¬Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ø³ÙŠØ±ÙŠ",
  "ØªÙ…ÙŠÙ… Ø·Ø§Ø±Ù‚ Ø­Ø³Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "ØªÙ…ÙŠÙ… Ù…Ø¨Ø§Ø±Ùƒ Ø¨Ù† ÙÙ‡Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ø¬Ø§Ø³Ø± Ø§Ø­Ù…Ø¯ Ø§Ø¨Ù† ØµØ§Ù„Ø­ Ø¹Ø³ÙŠØ±ÙŠ",
  "Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø¬Ø±Ù…Ø§Ù† Ø§Ù„Ø£Ø³Ù…Ø±ÙŠ",
  "Ø±ÙˆÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹ÙŠØ¯ Ù…Ø­Ø±ÙˆØ³",
  "Ø²ÙŠØ§Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "Ø³Ù„Ù…Ø§Ù† Ù…Ø­Ù…Ø¯ Ù†Ø§ØµØ± Ø¢Ù„ Ø§Ø­Ù…Ø¯",
  "Ø¹Ø¨Ø¯ Ø§Ù„Ø§Ù„Ù‡ Ø§Ø­Ù…Ø¯ Ø­Ø³Ù† Ø§Ù„Ù‡ÙŠØ²Ø¹ÙŠ",
  "Ø¹Ø² Ù…Ø­Ù…Ø¯ Ù…Ø±Ø¹ÙŠ Ø§Ù„Ù‚Ø±Ù†ÙŠ",
  "Ø¹Ù„ÙŠ Ø§Ø­Ù…Ø¯ Ù…Ø§Ø·Ø± Ø§Ù„ Ø´ÙˆØ§Ù",
  "Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø´Ø¯ÙŠØ¯ÙŠ",
  "Ø¹Ù„ÙŠ Ù…Ù†ØµÙˆØ± Ø¹Ø§Ù…Ø± Ø§Ù„Ù‚Ø±Ù†ÙŠ",
  "Ø¹Ù…Ø± Ø§Ø­Ù…Ø¯ Ù…Ø§Ø·Ø± Ø§Ù„ Ø´ÙˆØ§Ù",
  "Ù…Ø¤ÙŠØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
  "Ù…Ø±Ø§Ø¯ Ø³Ø¹ÙŠØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ø³ÙŠØ±ÙŠ",
  "Ù…Ø´Ø¹Ù„ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ ÙŠØ­ÙŠ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ",
  "Ù…Ø¹Ø§Ø¯ Ø¸Ø§ÙØ± Ø¹Ø§ÙŠØ¶ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",
  "Ù†ÙˆØ§Ù Ù…Ø§Ø¬Ø¯ Ø­Ù…ÙˆØ¯ Ø§Ù„Ø­Ø³Ø§Ù…",
  "Ù‡Ø´Ø§Ù… Ù…Ø­Ù…Ø¯ Ù…Ù†ØµÙˆØ± Ø§Ù„Ø¹Ø³ÙŠØ±ÙŠ",
  "Ù‡ÙŠØ«Ù… Ù…Ø­Ù…Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¢Ù„ Ù…Ø·Ø§Ø¹Ù†",
  "ÙŠØ­ÙŠÙ‰ Ø¬Ø¨Ø±Ø§Ù† ÙŠØ­ÙŠ Ø¢Ù„ Ø¬Ø­Ø¯Ù„",
  "ÙŠØ²Ù† Ø£Ù…ÙŠÙ† Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ù„ÙˆØ§Ù†",
  "ÙŠØ²ÙŠØ¯ ÙŠØ­ÙŠÙ‰ Ø³Ø¹Ø¯ Ø¹Ø³ÙŠØ±ÙŠ",
];

async function addStudents() {
  try {
    console.log("ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Firebase...");
    
    if (!firebaseConfig.apiKey || !firebaseConfig.projectId) {
      console.error("âŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Firebase ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© ÙÙŠ Ù…Ù„Ù .env");
      process.exit(1);
    }
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    console.log(`ğŸ“‹ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© ${students.length} Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«...\n`);

    let addedCount = 0;
    let errorCount = 0;

    for (const studentName of students) {
      try {
        const studentData = {
          name: studentName.trim(),
          grade: 3,
          points: {
            arabic: 0,
            math: 0,
            morningAssembly: 0,
            nafesExams: 0,
          },
          totalPoints: 0,
          rank: {
            id: 1,
            nameAr: "Ù…Ø³ØªÙƒØ´Ù ØµØºÙŠØ±",
            nameEn: "Junior Explorer",
            minPoints: 0,
            maxPoints: 10,
            icon: "ğŸŒ",
          },
          stamps: {
            silver: false,
            gold: false,
            diamond: false,
          },
          viewCount: 0,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString(),
        };

        await addDoc(collection(db, "students"), studentData);
        addedCount++;
        console.log(`âœ… [${addedCount}/${students.length}] ${studentName}`);
      } catch (error) {
        errorCount++;
        console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© ${studentName}:`, error.message);
      }
    }

    console.log(`\nâœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ${addedCount} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!`);
    if (errorCount > 0) {
      console.log(`âš ï¸  ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© ${errorCount} Ø·Ø§Ù„Ø¨`);
    }
    
    process.exit(0);
  } catch (error) {
    console.error("\nâŒ Ø®Ø·Ø£:", error.message);
    if (error.code === "permission-denied") {
      console.error("âš ï¸  Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª - ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Firestore");
    }
    process.exit(1);
  }
}

addStudents();

